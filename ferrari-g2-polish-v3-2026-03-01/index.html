<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ferrari Commercial G2.5 v3</title>
  <style>
    body { margin: 0; overflow: hidden; background: #070707; }
    #info { position: fixed; top: 12px; width: 100%; text-align: center; color: #d6d6d6; font: 12px/1.2 Arial, sans-serif; letter-spacing: 2px; text-transform: uppercase; pointer-events: none; }
  </style>
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>
</head>
<body>
  <div id="info">Ferrari Commercial G2.5 v3 â€” white horse + premium chairs</div>
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x080808);
    scene.fog = new THREE.FogExp2(0x080808, 0.012);

    const camera = new THREE.PerspectiveCamera(35, innerWidth / innerHeight, 0.1, 200);
    camera.position.set(4.2, 2.5, 6.8);
    camera.lookAt(0, 1.0, 0);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.25;
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.target.set(0, 1, 0);

    // Top-down key spotlight
    const key = new THREE.SpotLight(0xffffff, 5000, 45, Math.PI / 10, 0.65, 2.0);
    key.position.set(0, 18, 0);
    key.castShadow = true;
    key.shadow.mapSize.set(2048, 2048);
    key.target.position.set(0, 0.8, 0);
    scene.add(key.target, key);

    // Fill and rim so horse reads white
    const hemi = new THREE.HemisphereLight(0xffffff, 0x181818, 1.3);
    scene.add(hemi);
    const rim = new THREE.SpotLight(0xbdd6ff, 1200, 35, Math.PI / 4, 1, 2);
    rim.position.set(-6, 5, -7);
    rim.target.position.set(0, 1.2, 0);
    scene.add(rim.target, rim);
    const face = new THREE.PointLight(0xffffff, 220, 14);
    face.position.set(1.8, 2.6, 2.8);
    scene.add(face);

    // Floor
    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(70, 70),
      new THREE.MeshStandardMaterial({ color: 0x0a0a0a, roughness: 0.12, metalness: 0.75 })
    );
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);

    // Treadmill
    const treadmill = new THREE.Group();
    const base = new THREE.Mesh(new THREE.BoxGeometry(1.4, 0.18, 4.4), new THREE.MeshStandardMaterial({ color: 0x171717, roughness: 0.45, metalness: 0.55 }));
    base.position.y = 0.09;
    base.receiveShadow = true;
    treadmill.add(base);
    const beltTex = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/uv_grid_opengl.jpg');
    beltTex.wrapS = beltTex.wrapT = THREE.RepeatWrapping;
    beltTex.repeat.set(1, 6);
    const belt = new THREE.Mesh(new THREE.PlaneGeometry(1.15, 4.05), new THREE.MeshStandardMaterial({ map: beltTex, color: 0x0c0c0c, roughness: 0.88 }));
    belt.rotation.x = -Math.PI / 2;
    belt.position.y = 0.19;
    treadmill.add(belt);
    scene.add(treadmill);

    const loader = new GLTFLoader();

    // Horse (force white material)
    let mixer = null;
    loader.load('./assets/hero_horse.glb', (gltf) => {
      const horse = gltf.scene;
      const whiteHorse = new THREE.MeshPhysicalMaterial({
        color: 0xffffff,
        emissive: 0x141414,
        emissiveIntensity: 0.28,
        roughness: 0.34,
        metalness: 0.0,
        clearcoat: 0.65,
        clearcoatRoughness: 0.18,
        sheen: 1.0,
        sheenColor: 0xffffff
      });
      horse.traverse((o) => {
        if (o.isMesh) {
          o.castShadow = true;
          o.receiveShadow = true;
          o.material = whiteHorse.clone();
          o.material.map = null;
          o.material.needsUpdate = true;
        }
      });
      horse.scale.set(0.012, 0.012, 0.012);
      horse.position.set(0, 0.18, 0);
      horse.rotation.y = Math.PI;
      scene.add(horse);
      mixer = new THREE.AnimationMixer(horse);
      const action = mixer.clipAction(gltf.animations[0]);
      action.timeScale = 1.8;
      action.play();
    });

    // Premium chair field
    loader.load('./assets/premium_chair/modern_arm_chair_01_1k.gltf', (gltf) => {
      const chairRoot = gltf.scene;
      chairRoot.traverse((o) => {
        if (o.isMesh) {
          o.castShadow = false;
          o.receiveShadow = true;
          if (o.material) {
            o.material.roughness = Math.min(1, (o.material.roughness ?? 0.6) + 0.1);
          }
        }
      });

      const rings = [8, 10, 12.5, 15, 18, 21];
      rings.forEach((r, ri) => {
        const count = Math.floor((2 * Math.PI * r) / 1.8);
        for (let i = 0; i < count; i++) {
          const a = (i / count) * Math.PI * 2;
          if (a > Math.PI * 0.82 && a < Math.PI * 1.18) continue; // front gap for camera
          const c = chairRoot.clone(true);
          c.scale.setScalar(0.55);
          c.position.set(Math.cos(a) * r, 0.0 + ri * 0.11, Math.sin(a) * r);
          c.lookAt(0, 0.9, 0);
          scene.add(c);
        }
      });
    });

    const clock = new THREE.Clock();
    function loop() {
      requestAnimationFrame(loop);
      const dt = clock.getDelta();
      if (mixer) mixer.update(dt);
      // belt moving opposite horse travel
      beltTex.offset.y += dt * 1.8;
      controls.update();
      renderer.render(scene, camera);
    }
    loop();

    addEventListener('resize', () => {
      camera.aspect = innerWidth / innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });
  </script>
</body>
</html>
